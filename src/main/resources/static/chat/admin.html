<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>LeanCloud Realtime JavaScript SDK</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="user-scalable=no">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<h1 id="title"></h1>
<div class="item">
    <div id="print-wall" class="print-wall"></div>
</div>

<div class="item">
    <label>输入信息：</label>
    <input id="input-send" class="input-send" type="text">
    <div id="send-btn" class="btn">发送</div>
</div>

<!-- Demo 逻辑文件 -->
<script src="../front/js/jquery.min.js"></script>
<script src="realtime.browser.js"></script>
<script src="chat.js"></script>
<script>
    (function () {
        $('#send-btn').on('click', function () {
            var ip = $('#input-send');
            if (ip.val() == null || ip.val() == '' || ip.val() == undefined)
                return;
            sendMessage(ip.val());
        });

        var adminName = "admin";
        var consumeName = "用户187423";

        $('#title').text(consumeName);

        $.lc.init(function (success) {
            if (success) {
                $.lc.rtc.session.create(function (obj) {
                    $.lc.rtc.client.create(adminName, function (obj) {
                        console.log('client registe');
                        if ($.lc.rtc.conversation.body.id == undefined) {

                            $.lc.rtc.conversation.create({
                                'objectId': '5afd50429f5454004671db19',
                                'name': consumeName,
                                'members': [consumeName]
                            }, function () {
                                console.log('build conversation')


                            });
                        }

                        $.lc.rtc.conversation.receive(function (msg, conversation) {
                            receive(msg);
                        })
                    });
                });
            }
        });
    })()

    function sendMessage(msg) {
        $.lc.rtc.conversation.send(msg, function (result) {
            var htm = result.text + '<br>';
            $('#print-wall').append(htm);
        })
    }

    function receive(msg) {
        var htm = msg.text + '<br>';
        $('#print-wall').append(htm);
    }
</script>
</body>

</html>
